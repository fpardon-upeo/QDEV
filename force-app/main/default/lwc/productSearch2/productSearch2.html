<!-- /* created by :
    Abdelhafid Khribech 
    on 02/12/2022 
*/ -->
<template>

    <lightning-tabset>
        <lightning-tab label="Car">
            <!-- Search Input -->
            <div class="slds-grid slds-wrap">
                <div class="slds-col slds-size_1-of-3">
                    <div class="slds-col slds-size_4-of-5 slds-align_absolute-center slds-box slds-grid slds-m-top_small slds-wrap" if:true={showLabelFilter}>
                        <lightning-combobox class="slds-col slds-size_1-of-3 slds-p-horizontal_xx-small" 
                                            name="progress"
                                            label="Fuel"
                                            value={fuelValue}
                                            placeholder="Choose"
                                            options={fuelOptions}
                                            onchange={handleFuelChange} ></lightning-combobox>
                        <lightning-combobox class="slds-col slds-size_1-of-3 slds-p-horizontal_xx-small"
                                            name="progress"
                                            label="Grip"
                                            value={gripValue}
                                            placeholder="Choose"
                                            options={gripOptions}
                                            disabled={disabledGrip}
                                            onchange={handleGripChange} ></lightning-combobox>
                        <lightning-combobox class="slds-col slds-size_1-of-3 slds-p-horizontal_xx-small" 
                                            name="progress"
                                            label="Noise"
                                            value={noiseValue}
                                            placeholder="Choose"
                                            options={noiseOptions}
                                            disabled={disabledNoise}
                                            onchange={handleNoiseChange} ></lightning-combobox>
                        
                    
                </div>
                    <!-- <lightning-combobox class="slds-col slds-m-left_xx-large slds-m-top_xx-large slds-size_1-of-4" style="display:inline-block;margin-left:30%;margin-:35%"
                        name="progress"
                        label="Brand"
                        value={brandValue}
                        placeholder="Choose"
                        options={brandsOptions}
                        onchange={handleBrandChange} >
                    </lightning-combobox> -->
                    <!-- <lightning-combobox class="slds-col slds-size_1-of-3 slds-m-left_large" style="display:inline-block;"
                        name="progress"
                        label="Type of season"
                        value={seasonValue}
                        placeholder="Choose"
                        options={seasonOptions}
                        onchange={handleSeasonChange} >
                    </lightning-combobox>
                    <lightning-input class="slds-col slds-size_1-of-2 slds-m-left_large"
                                name="enter-search"
                                type="search"
                                placeholder="Enter an homologation"
                                onchange={handleSearchHomologationChange}
                        ></lightning-input> -->
                </div>
                <div class="slds-col slds-size_1-of-3 ">
                    <div>
                        <lightning-input
                                name="enter-search"
                                type="search"
                                placeholder="Enter search term"
                                onchange={handleSearchTermChange}
                        ></lightning-input>
                    </div>
                    <!-- Radio Buttons to add filters like dimension -->
                    <div class="slds-m-top_small slds-align_absolute-center">
                        <lightning-button class="slds-m-left_small" variant="brand" label="Tier details" onclick={handleDimensionChange}></lightning-button>
                        <lightning-button class="slds-m-left_small" variant="brand" label="Specifications" onclick={handleSpecificationChange}></lightning-button>
                        <lightning-button class="slds-m-left_small" variant="brand" label="Labels" onclick={handleLabelChange}></lightning-button>
                    </div>
                </div>
                <div class="slds-col slds-size_1-of-3 slds-m-top_medium" style="margin-top: 1.7%;">
                    <lightning-button class="slds-m-right_small slds-p-left_x-large" label="Search" onclick={search} ></lightning-button>
                </div>
            </div>

            <!-- Dimension filter section -->
            <div class="slds-grid slds-wrap" if:true={showDimensionFilter}>
                <div class="slds-col slds-size_1-of-4 slds-m-top_medium">
                    <lightning-combobox class="slds-col slds-size_1-of-2 slds-float_right slds-p-right_xx-large slds-m-top_small"
                            name="progress"
                            label="Brand"
                            value={brandValue}
                            placeholder="Choose"
                            options={brandsOptions}
                            onchange={handleBrandChange} >
                        </lightning-combobox>
                </div>
                <div class="slds-col slds-size_2-of-4">
                    <div class="slds-box slds-grid slds-m-top_small slds-wrap slds-align_absolute-center">
                        <lightning-combobox class="slds-col slds-size_1-of-5 slds-p-horizontal_x-small"
                                            name="progress"
                                            label="Width"
                                            value={widthValue}
                                            placeholder="Choose"
                                            options={widthOptions}
                                            onchange={handleWidthChange} ></lightning-combobox>
                        <lightning-combobox class="slds-col slds-size_1-of-5 slds-p-horizontal_x-small"
                                            name="progress"
                                            label="Height"
                                            value={heightValue}
                                            placeholder="Choose"
                                            options={heightOptions}
                                            disabled={disabledHeigth}
                                            onchange={handleHeightChange} ></lightning-combobox>
                        <lightning-combobox class="slds-col slds-size_1-of-5 slds-p-horizontal_x-small"
                                            name="progress"
                                            label="Inches"
                                            value={inchesValue}
                                            placeholder="Choose"
                                            options={inchesOptions}
                                            disabled={disabledInches}
                                            onchange={handleInchesChange} ></lightning-combobox>
                        <lightning-combobox class="slds-col slds-size_1-of-5 slds-p-horizontal_x-small"
                                            name="progress"
                                            label="Load capacity"
                                            value={capacityValue}
                                            placeholder="Choose"
                                            options={capacityOptions}
                                            disabled={disabledCapacity}
                                            onchange={handleCapacityChange} ></lightning-combobox>
                        <lightning-combobox class="slds-col slds-size_1-of-5 slds-p-horizontal_x-small"
                                            name="progress"
                                            label="Speed index"
                                            value={speedValue}
                                            placeholder="Choose"
                                            options={speedOptions}
                                            disabled={disabledSpeed}
                                            onchange={handleSpeedChange} ></lightning-combobox>
                    </div>
                </div>
                <div class="slds-col slds-size_1-of-4 slds-m-top_medium">
                    <lightning-combobox class="slds-col slds-size_1-of-2 slds-float_left slds-p-left_xx-large slds-m-top_small"
                        name="progress"
                        label="Season"
                        value={seasonValue}
                        placeholder="Choose"
                        options={seasonOptions}
                        onchange={handleSeasonChange} >
                    </lightning-combobox>
                </div>
            </div>
            <!-- <div class="slds-m-top_medium">
                <div class="exampleHolder" if:false={isLoaded}>
                    <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                </div>
                <template for:each={searchResults} for:item="result">
                    <div key={result.id} style="border: 3px outset rgba(110,106,106,0.82);border-radius: 12px;padding: 5px;" class="slds-box slds-m-bottom_medium">
                        <h3 slot="title" class="slds-text-heading_large slds-m-bottom_small">
                            {result.brandName} - {result.profile}
                        </h3>
                        <table>
                            <tr>
                                <th>Saison</th>
                                <th>Tier</th>
                                <th>Marque</th>
                                <th>Dimension</th>
                                <th>LI</th>
                                <th>SR</th>
                                <th>Profil</th>
                                <th>RR</th>
                                <th>Adhérence</th>
                                <th>Bruit</th>
                                <th>Fournisseur</th>
                                <th>List Price</th>
                                <th>Sales Price</th>
                                <th>Delivery Date</th>
                                <th>Stock</th>
                                <th>Order</th>
                            </tr>
                            <tr key={result.id}>
                                <td>
                                    <lightning-formatted-rich-text
                                    value={result.seasonImg}
                                ></lightning-formatted-rich-text></td>
                                <td>{result.category}</td>
                                <td><lightning-formatted-rich-text
                                    value={result.brandImg}
                                ></lightning-formatted-rich-text></td>
                                <td>{result.dimension}</td>
                                <td>{result.loadFactor}</td>
                                <td>{result.speedRating}</td>
                                <td>{result.brandProfile}</td>
                                <td>{result.fuel}</td>
                                <td>
                                    <lightning-formatted-rich-text
                                    value={Fuel}
                                ></lightning-formatted-rich-text></td>
                                <td>{result.grip}</td>
                                <td>{result.noise}</td>
                                <td><lightning-formatted-rich-text
                                    value={result.label}
                                ></lightning-formatted-rich-text></td>
                                <td>{result.supplier}</td>
                                <td><lightning-formatted-number format-style="currency" value={result.listPrice} currency-code="EUR"></lightning-formatted-number></td>
                                <td><lightning-formatted-number format-style="currency" value={result.salesPrice} currency-code="EUR"></lightning-formatted-number></td>
                                <td>{result.deliveryDate}</td>
                                <td>{result.quantity}</td>
                                <td>
                                    <input
                                        class="selector-input"
                                        max={result.quantity}
                                        min="2"
                                        step="2"
                                        required
                                        type="number"
                                    />
                                </td>
                                <td>
                                    <lightning-button-icon
                                            variant="brand"
                                            icon-name="utility:cart"
                                            alternative-text="Add to cart"
                                            data-index={result.index}
                                            data-id={result.productId}
                                            style="padding:5%;"
                                            onclick={handleAddToCart}
                                    >
                                    </lightning-button-icon>
                                </td>
                            </tr>


                        <div key={result.id} class="slds-grid">
                            <div class="infoTable slds-m-right_medium">
                                <table class="slds-no-flex">
                                    <tr class="descriptiontable">
                                        <td class="slds-text-heading_medium descriptiontable boldtext">
                                            Brand:
                                        </td>
                                        <td class="slds-text-heading_medium descriptiontable">
                                            {result.brandName}
                                        </td>
                                    </tr>
                                    <tr class="descriptiontable">
                                        <td class="slds-text-heading_medium descriptiontable boldtext">
                                            Dimension:
                                        </td>
                                        <td class="slds-text-heading_medium descriptiontable">
                                            {result.dimension}
                                        </td>
                                    </tr>
                                    <tr class="descriptiontable">
                                        <td class="slds-text-heading_medium descriptiontable boldtext">
                                            Brand / Profil:
                                        </td>
                                        <td class="slds-text-heading_medium descriptiontable">
                                            {result.brandProfile}
                                        </td>
                                    </tr>
                                    <tr class="descriptiontable">
                                        <td class="slds-text-heading_medium descriptiontable boldtext">
                                            Label:
                                        </td>
                                        <td class="descriptiontable">
                                            <lightning-formatted-rich-text
                                                    value={result.label}
                                            ></lightning-formatted-rich-text>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="slds-m-right_small">
                                <lightning-formatted-rich-text
                                        value={result.img}
                                ></lightning-formatted-rich-text>
                            </div>
                            <div class="productResult">
                                <table class="nth-table slds-m-bottom_medium">
                                    <tr>
                                        <th></th>
                                        <th>Supplier</th>
                                        <th>Delivery Date</th>
                                        <th>Stock</th>
                                        <th>Sales Price</th>
                                        <th>Order</th>
                                        <th style="display:hidden;border:0px" class="field"></th>
                                    </tr>
                                    <tr key={result.id} class="searchtable">
                                        <td></td>
                                        <td>{result.supplier}</td>
                                        <td>{result.deliveryDate}</td>
                                        <td>{result.quantity}</td>
                                        <td><lightning-formatted-number format-style="currency" value={result.salesPrice} currency-code="EUR"></lightning-formatted-number></td>
                                        <td>
                                            <input
                                                class="selector-input"
                                                max={result.quantity}
                                                min="2"
                                                step="2"
                                                required
                                                type="number"
                                            />
                                        </td>
                                        <td>
                                            <lightning-button-icon
                                                    variant="brand"
                                                    icon-name="utility:cart"
                                                    alternative-text="Add to cart"
                                                    data-index={result.index}
                                                    data-id={result.productId}
                                                    style="padding:5%;"
                                                    onclick={handleAddToCart}
                                            >
                                            </lightning-button-icon>
                                        </td>
                                    </tr>
                                    Loop through the wholesalers lines
                                    <template for:each={result.wholesalers} for:item="whs">
                                        <tr key={whs.id} if:true={whs.showLine}>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td><lightning-formatted-number format-style="currency" value={result.listPrice} currency-code="EUR"></lightning-formatted-number></td>
                                            <td><lightning-formatted-number format-style="currency" value={whs.salesPrice} currency-code="EUR"></lightning-formatted-number></td>
                                            <td>{whs.deliveryDate}</td>
                                            <td>{whs.quantity}</td>
                                            <td>
                                                <input
                                                        class="selector-input"
                                                        max={whs.quantity}
                                                        min="2"
                                                        step="2"
                                                        required
                                                        type="number"
                                                />
                                            </td>
                                            <td style="border: 0px;">
                                                <lightning-button-icon
                                                        variant="brand"
                                                        alternative-text="Add to cart"
                                                        icon-name="utility:cart"
                                                        data-index={result.index}
                                                        style="padding:5%;"
                                                >
                                                </lightning-button-icon>
                                            </td>
                                            <td>
                                                <lightning-button-stateful
                                                        if:true={whs.showButton}
                                                        variant="brand"
                                                        onclick={showAllWhsLines}
                                                        label="Toggle Lines"
                                                        data-index={result.index}
                                                        style="padding:5%;"
                                                        label-when-off="More"
                                                        label-when-on="Less"
                                                        selected={whs.buttonState}
                                                ></lightning-button-stateful>
                                            </td>
                                        </tr>
                                    </template>
                                    <template for:each={result.manufacturers} for:item="mfc">
                                        <tr key={mfc.id} if:true={mfc.showLine} style="border-spacing:10px 5px" class="slds-m-top_medium">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>{mfc.supplier}</td>
                                            <td><lightning-formatted-number format-style="currency" value={result.listPrice} currency-code="EUR"></lightning-formatted-number></td>
                                            <td><lightning-formatted-number format-style="currency" value={mfc.salesPrice} currency-code="EUR"></lightning-formatted-number></td>
                                            <td>{mfc.deliveryDate}</td>
                                            <td>{mfc.quantity}</td>
                                            <td>
                                                <input
                                                        class="selector-input"
                                                        max={mfc.quantity}
                                                        min="2"
                                                        step="2"
                                                        required
                                                        type="number"
                                                />
                                            </td>
                                            <td style="border: 0px;">
                                                <lightning-button-icon
                                                        variant="brand"
                                                        alternative-text="Add to cart"
                                                        icon-name="utility:cart"
                                                        data-index={result.index}
                                                        style="padding:5%;"
                                                >
                                                </lightning-button-icon>
                                            </td>
                                            <td>
                                                <lightning-button-stateful
                                                        if:true={mfc.showButton}
                                                        variant="brand"
                                                        onclick={showAllMfgLines}
                                                        label="Toggle Lines"
                                                        data-index={result.index}
                                                        style="padding:5%;"
                                                        label-when-off="More"
                                                        label-when-on="Less"
                                                        selected={mfc.buttonState}
                                                >
                                                </lightning-button-stateful>
                                            </td>
                                        </tr>
                                    </template>

                                </table>
                            </div>
                        </div>
                        </table>
                    </div>
                </template>
            </div> -->

            <div class="slds-m-top_medium">
                <table class="nth-table">
                    <thead>
                    <tr>
                        <th>{seasonLabel}</th>
                        <th style="width: 13% ;">{brandLabel}</th>
                        <th style="width: 13% ;">{descriptionLabel}</th>
                        <th style="width: 6.5% ;"><img style="height : 140%; width:70%" src={fuelImage}/></th>
                        <th style="width: 6.5% ;"><img style="height : 140%; width:70%" src={gripImage}/></th>
                        <th style="width: 6.5% ;"><img style="height : 140%; width:70%" src={noiseImage}/></th>
                        <th>{supplierLabel}</th>
                        <th style="width: 9% ;">{listPriceLabel}</th>
                        <th style="width: 10% ;">{salesPriceLabel}</th>
                        <th style="width: 11% ;">{deliveryDateLabel}</th>
                        <th>{stockLabel}</th>
                        <th>{quantityLabel}</th>
                        <th></th>
                        <th style="background:white;"></th>
                    </tr>
                    </thead>
                    <template for:each={searchResults} for:item="result" for:index="index">
                        <tbody key={result.id}>
                        <tr class="productrow descriptiontable">
                            <td>
                                <lightning-formatted-rich-text value={result.season}></lightning-formatted-rich-text>
                            </td>
                            <td>
                                <lightning-formatted-rich-text value={result.brandLogo} style="width:100%;height:100%"></lightning-formatted-rich-text>
                            </td>
                            <td>{result.dimension}</td>
                            <td><a href={result.QReprelLink}>{result.fuel}</a></td>
                            <td><a href={result.QReprelLink}>{result.grip}</a></td>
                            <td><a href={result.QReprelLink}>{result.noise}</a></td>
                            <td>
                                <lightning-formatted-rich-text class="slds-rich-text-editor__output" value={result.supplier}></lightning-formatted-rich-text>
                            </td>
                            <td>
                                <lightning-formatted-number format-style="currency" value={result.listPrice} currency-code="EUR"></lightning-formatted-number>                  
                            </td>
                            <td>
                                <lightning-formatted-number format-style="currency" value={result.salesPrice} currency-code="EUR"></lightning-formatted-number>
                            </td>
                            <td>
                                {result.deliveryDate}
                            </td>
                            <td>
                                {result.quantity}
                            </td>
                            <td>
                                <input style="width: 40px ;"
                                    class="selector-input"
                                    max={result.quantity}
                                    value="2"
                                    min="2"
                                    step="2"
                                    required
                                    type="number"
                                    data-index={result.index}
                                    data-type="wholesaler"
                                    onchange = {handleQuantityChange}
                                />
                            </td>
                            <td>
                                <lightning-button-icon
                                        variant="brand"
                                        icon-name="utility:cart"
                                        alternative-text="Add to cart"
                                        data-index={result.index}
                                        data-id={result.productId}
                                        data-price={result.salesPrice}
                                        data-deliverydate={result.deliveryDate}
                                        data-orderquantity={result.orderQuantity}
                                        style="padding:5%;"
                                        onclick={handleAddToCart}
                                >
                                </lightning-button-icon>
                            </td>
                            <td style="background:white;"></td>
                        </tr>
                            <template for:each={result.wholesalers} for:item="whs">
                                <tr class="subrow descriptiontable" if:true={whs.showLine} key={whs.id}>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td> 
                                        {result.supplier}
                                    </td>
                                    <td><lightning-formatted-number format-style="currency" value={whs.listPrice} currency-code="EUR"></lightning-formatted-number></td>
                                    <td>
                                        <lightning-formatted-number format-style="currency" value={whs.salesPrice} currency-code="EUR"></lightning-formatted-number>
                                    </td>
                                    <td>
                                        {whs.deliveryDate}
                                    </td>
                                    <td>
                                        {whs.quantity}
                                    </td>
                                    <td>
                                        <input
                                            class="selector-input" style="width: 40px ;"
                                            max={whs.quantity}
                                            value="2"
                                            min="2"
                                            step="2"
                                            required
                                            type="number"
                                            data-index={whs.index}
                                            data-productindex={result.index}
                                            data-type="wholesaler-other"
                                            onchange = {handleQuantityChange}
                                        />
                                    </td>
                                    <td>
                                        <lightning-button-icon
                                                variant="brand"
                                                icon-name="utility:cart"
                                                alternative-text="Add to cart"
                                                product-index={result.index}
                                                data-index={result.index}
                                                data-id={result.productId}
                                                data-price={whs.salesPrice}
                                                data-deliverydate={whs.deliveryDate}
                                                data-orderquantity={whs.orderQuantity}
                                                style="padding:5%;"
                                                onclick={handleAddToCart}
                                        >
                                        </lightning-button-icon>
                                    </td>
                                    <td style="background:white;">
                                        <lightning-button-stateful
                                                if:true={whs.showButton}
                                                variant="brand"
                                                onclick={showAllWhsLines}
                                                label="Toggle Lines"
                                                data-index={result.index}
                                                style="padding:5%;"
                                                label-when-off="More"
                                                label-when-on="Less"
                                                selected={whs.buttonState}
                                        ></lightning-button-stateful>
                                    </td>
                                </tr>
                            </template>
                        <template for:each={result.manufacturers} for:item="mfg">
                            <tr class="subrow descriptiontable" if:true={mfg.showLine} key={mfg.id}>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td><lightning-formatted-rich-text class="slds-rich-text-editor__output" value={mfg.supplier}></lightning-formatted-rich-text></td>
                                <td><lightning-formatted-number format-style="currency" value={mfg.listPrice} currency-code="EUR"></lightning-formatted-number></td>
                                <td>
                                    <lightning-formatted-number format-style="currency" value={mfg.salesPrice} currency-code="EUR"></lightning-formatted-number>
                                </td>
                                <td>
                                    {mfg.deliveryDate}
                                </td>
                                <td>
                                    {mfg.quantity}
                                </td>
                                <td>
                                    <input
                                        class="selector-input"  style="width: 40px ;"
                                        max={mfg.quantity}
                                        value="2"
                                        min="2"
                                        step="2"
                                        required
                                        type="number"
                                        data-index={mfg.index}
                                        data-productindex={result.index}
                                        data-type="manufacturer"
                                        onchange = {handleQuantityChange}
                                    />
                                </td>
                                <td>
                                    <lightning-button-icon
                                            variant="brand"
                                            icon-name="utility:cart"
                                            alternative-text="Add to cart"
                                            data-product-index={result.index}
                                            data-index={result.index}
                                            data-id={result.productId}
                                            data-price={mfg.salesPrice}
                                            data-deliverydate={mfg.deliveryDate}
                                            data-orderquantity={mfg.orderQuantity}
                                            style="padding:5%;"
                                            onclick={handleAddToCart}
                                    >
                                    </lightning-button-icon>
                                </td>
                                <td style="background:white;">
                                    <lightning-button-stateful
                                            if:true={mfg.showButton}
                                            variant="brand"
                                            onclick={showAllMfgLines}
                                            label="Toggle Lines"
                                            data-index={result.index}
                                            style="padding:5%;"
                                            label-when-off="More"
                                            label-when-on="Less"
                                            selected={mfg.buttonState}
                                    ></lightning-button-stateful>
                                </td>
                            </tr>
                        </template>
                        </tbody>
                    </template>
                </table>
            </div>
        </lightning-tab>
    </lightning-tabset>
</template>